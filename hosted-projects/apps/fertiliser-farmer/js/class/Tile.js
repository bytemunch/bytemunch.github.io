import { WorldActor } from './WorldActor.js';
import { tileGrid, sprites, layers, camera, LAYERNUMBERS } from '../main.js';
import { pointInPolygon } from '../functions/collision.js';
export const newTileFromJSON = (data) => {
    return new Tile({
        gridPosition: { gridX: data.gridX, gridY: data.gridY },
        sprite: sprites[data.type],
        type: data.type,
        droppable: data.droppable
    });
};
export class Tile extends WorldActor {
    constructor(opts) {
        super(opts);
        this.droppable = false;
        this.draggedOver = false;
        this.baseClass = 'tile';
        this.layer = LAYERNUMBERS.tile;
        this.droppable = opts.droppable;
        this.width = 64;
        this.height = 32;
    }
    toJSON() {
        return {
            type: this.type,
            layer: this.layer,
            gridX: this.gridX,
            gridY: this.gridY,
            droppable: this.droppable
        };
    }
    get contents() {
        return tileGrid[this.gridX][this.gridY].contents;
    }
    get ne() {
        return (this.gridY % 2) ? tileGrid[this.gridX - 1][this.gridY - 1] : tileGrid[this.gridX][this.gridY - 1];
    }
    get nw() {
        return (this.gridY % 2) ? tileGrid[this.gridX][this.gridY - 1] : tileGrid[this.gridX + 1][this.gridY - 1];
    }
    get sw() {
        return (this.gridY % 2) ? tileGrid[this.gridX][this.gridY + 1] : tileGrid[this.gridX + 1][this.gridY + 1];
    }
    get se() {
        return (this.gridY % 2) ? tileGrid[this.gridX - 1][this.gridY + 1] : tileGrid[this.gridX][this.gridY + 1];
    }
    get points() {
        return [
            [this._x + this.width / 2, this._y],
            [this._x + this.width, this._y + this.height / 2],
            [this._x + this.width / 2, this._y + this.height],
            [this._x, this._y + this.height / 2],
        ];
    }
    draw() {
        if (!super.draw())
            return false;
        if (this.draggedOver) {
            const ctx = layers[this.layer].ctx;
            ctx.fillStyle = '#ff000088';
            ctx.beginPath();
            ctx.moveTo(this.points[0][0], this.points[0][1]);
            for (let p of this.points) {
                ctx.lineTo(p[0], p[1]);
            }
            ctx.closePath();
            ctx.fill();
        }
        return true;
    }
    collides(x, y) {
        x *= 1 / camera.scale;
        y *= 1 / camera.scale;
        return pointInPolygon(this.points, [x, y]);
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUM7WUFDbkMsR0FBRyxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUM7WUFDNUIsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2hCLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUN2QixHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUMxQjtZQUNELEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNoQixHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDZDtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDVCxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ3RCLE9BQU8sY0FBYyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvQyxDQUFDO0NBQ0oiLCJmaWxlIjoiY2xhc3MvVGlsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFdvcmxkQWN0b3IsIElBY3Rvck9wdGlvbnMgfSBmcm9tICcuL1dvcmxkQWN0b3IuanMnO1xuaW1wb3J0IHsgdGlsZUdyaWQsIHNwcml0ZXMsIGxheWVycywgY2FtZXJhLCBMQVlFUk5VTUJFUlMgfSBmcm9tICcuLi9tYWluLmpzJztcbmltcG9ydCB7IHBvaW50SW5Qb2x5Z29uIH0gZnJvbSAnLi4vZnVuY3Rpb25zL2NvbGxpc2lvbi5qcyc7XG5cbmV4cG9ydCBjb25zdCBuZXdUaWxlRnJvbUpTT04gPSAoZGF0YSkgPT4ge1xuICAgIHJldHVybiBuZXcgVGlsZSh7XG4gICAgICAgIGdyaWRQb3NpdGlvbjogeyBncmlkWDogZGF0YS5ncmlkWCwgZ3JpZFk6IGRhdGEuZ3JpZFkgfSxcbiAgICAgICAgc3ByaXRlOiBzcHJpdGVzW2RhdGEudHlwZV0sXG4gICAgICAgIHR5cGU6IGRhdGEudHlwZSxcbiAgICAgICAgZHJvcHBhYmxlOiBkYXRhLmRyb3BwYWJsZVxuICAgIH0pXG59XG5cbmV4cG9ydCBjbGFzcyBUaWxlIGV4dGVuZHMgV29ybGRBY3RvciB7XG4gICAgZHJvcHBhYmxlID0gZmFsc2U7XG4gICAgZHJhZ2dlZE92ZXIgPSBmYWxzZTtcbiAgICBiYXNlQ2xhc3MgPSAndGlsZSc7XG4gICAgbGF5ZXIgPSBMQVlFUk5VTUJFUlMudGlsZTtcbiAgICBcbiAgICBjb25zdHJ1Y3RvcihvcHRzPzogSUFjdG9yT3B0aW9ucykge1xuICAgICAgICBzdXBlcihvcHRzKTtcblxuICAgICAgICB0aGlzLmRyb3BwYWJsZSA9IG9wdHMuZHJvcHBhYmxlO1xuXG4gICAgICAgIHRoaXMud2lkdGggPSA2NDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSAzMjtcbiAgICB9XG5cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiB0aGlzLnR5cGUsXG4gICAgICAgICAgICBsYXllcjogdGhpcy5sYXllcixcbiAgICAgICAgICAgIGdyaWRYOiB0aGlzLmdyaWRYLFxuICAgICAgICAgICAgZ3JpZFk6IHRoaXMuZ3JpZFksXG4gICAgICAgICAgICBkcm9wcGFibGU6IHRoaXMuZHJvcHBhYmxlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgY29udGVudHMoKSB7XG4gICAgICAgIHJldHVybiB0aWxlR3JpZFt0aGlzLmdyaWRYXVt0aGlzLmdyaWRZXS5jb250ZW50cztcbiAgICB9XG5cbiAgICBnZXQgbmUoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5ncmlkWSAlIDIpID8gdGlsZUdyaWRbdGhpcy5ncmlkWCAtIDFdW3RoaXMuZ3JpZFkgLSAxXSA6IHRpbGVHcmlkW3RoaXMuZ3JpZFhdW3RoaXMuZ3JpZFkgLSAxXTtcbiAgICB9XG5cbiAgICBnZXQgbncoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5ncmlkWSAlIDIpID8gdGlsZUdyaWRbdGhpcy5ncmlkWF1bdGhpcy5ncmlkWSAtIDFdIDogdGlsZUdyaWRbdGhpcy5ncmlkWCArIDFdW3RoaXMuZ3JpZFkgLSAxXTtcbiAgICB9XG5cbiAgICBnZXQgc3coKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5ncmlkWSAlIDIpID8gdGlsZUdyaWRbdGhpcy5ncmlkWF1bdGhpcy5ncmlkWSArIDFdIDogdGlsZUdyaWRbdGhpcy5ncmlkWCArIDFdW3RoaXMuZ3JpZFkgKyAxXTtcbiAgICB9XG5cbiAgICBnZXQgc2UoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5ncmlkWSAlIDIpID8gdGlsZUdyaWRbdGhpcy5ncmlkWCAtIDFdW3RoaXMuZ3JpZFkgKyAxXSA6IHRpbGVHcmlkW3RoaXMuZ3JpZFhdW3RoaXMuZ3JpZFkgKyAxXTtcbiAgICB9XG5cbiAgICBnZXQgcG9pbnRzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgWyg8bnVtYmVyPnRoaXMuX3gpICsgdGhpcy53aWR0aCAvIDIsICg8bnVtYmVyPnRoaXMuX3kpXSxcbiAgICAgICAgICAgIFsoPG51bWJlcj50aGlzLl94KSArIHRoaXMud2lkdGgsICg8bnVtYmVyPnRoaXMuX3kpICsgdGhpcy5oZWlnaHQgLyAyXSxcbiAgICAgICAgICAgIFsoPG51bWJlcj50aGlzLl94KSArIHRoaXMud2lkdGggLyAyLCAoPG51bWJlcj50aGlzLl95KSArIHRoaXMuaGVpZ2h0XSxcbiAgICAgICAgICAgIFsoPG51bWJlcj50aGlzLl94KSwgKDxudW1iZXI+dGhpcy5feSkgKyB0aGlzLmhlaWdodCAvIDJdLFxuICAgICAgICBdXG4gICAgfVxuXG4gICAgZHJhdygpIHtcbiAgICAgICAgaWYgKCFzdXBlci5kcmF3KCkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBpZiAodGhpcy5kcmFnZ2VkT3Zlcikge1xuICAgICAgICAgICAgY29uc3QgY3R4ID0gbGF5ZXJzW3RoaXMubGF5ZXJdLmN0eDtcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZmMDAwMDg4JztcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8odGhpcy5wb2ludHNbMF1bMF0sIHRoaXMucG9pbnRzWzBdWzFdKTtcbiAgICAgICAgICAgIGZvciAobGV0IHAgb2YgdGhpcy5wb2ludHMpIHtcbiAgICAgICAgICAgICAgICBjdHgubGluZVRvKHBbMF0sIHBbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBjb2xsaWRlcyh4LCB5KSB7XG4gICAgICAgIHggKj0gMSAvIGNhbWVyYS5zY2FsZTtcbiAgICAgICAgeSAqPSAxIC8gY2FtZXJhLnNjYWxlO1xuICAgICAgICByZXR1cm4gcG9pbnRJblBvbHlnb24odGhpcy5wb2ludHMsIFt4LCB5XSk7XG4gICAgfVxufVxuIl19
